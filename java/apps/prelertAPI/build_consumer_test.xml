<?xml version="1.0" encoding="UTF-8"?>
<project name="Prelert CA OEM API" default="build" basedir=".">
	<description>
		Build file for the Prelert OData API consumer tests
	</description>

	<property environment="env" />

    <!-- CONFIGURING THE BUILD 
        
        These jar files are required to build prelertApiConsumer.jar
            - json-simple-1.1.1.jar
            - log4j-1.2.16.jar
            - odata4j-0.7.0-bundle.jar
            - CLWorkstation.jar
            - SuperCSV-1.52.jar
            
        All these jar files should be copied to the same directory, by default 
        this should be ./libs but it can be changed by setting the 'libs.dir'
        property below.
        
        This file should be run from the project root directory (the directory
        containing the 'source', 'com' & 'docs' folders). If a different project
        directory is being used change the property 'project.basedir'.
        
        
        There are 3 targets: clean, compile & build. build is the default 
        and invoking it will create prelertApiConsumer.jar and write it
        to 'jar.output.dir'.
        
        e.g.
            ant clean
            ant build
            
    -->

	
	<!-- Set base directory properties -->
	<property name="project.basedir" value="." />
    <property name="source.dir" value="${project.basedir}/source" />
    
    <!-- 
        The location of the required jar files. Change this property 
        if using a different location. 
    -->
	<property name="libs.dir" location="${project.basedir}/libs" />
    
    <!-- The directory the built jar file will be written to. -->
	<property name="jar.output.dir" location="${project.basedir}/../jar" />    


	<!-- Set global properties for this build -->
	<property name="name" value="prelertApi"/>
   	<property name="build.dir" location="${project.basedir}" />
    

	<!-- Required jar files -->
	<path id="build.classpath">           
        <!-- Json-Simple JAR -->
		<fileset dir="${libs.dir}">
			<include name="json-simple-1.1.1.jar" />
		</fileset>    

		<!-- log4j JAR -->
		<fileset dir="${libs.dir}">
			<include name="log4j-1.2.16.jar" />
		</fileset>
        
        <!-- OData -->
		<fileset dir="${libs.dir}">
			<include name="odata4j-0.7.0-bundle.jar" />
		</fileset>          
        
        <!-- CLW version 9.x -->
        <fileset dir="${libs.dir}">
			<include name="CLWorkstation.jar" />
		</fileset>
        
        <!-- SuperCSV -->
		<fileset dir="${libs.dir}">
			<include name="SuperCSV-1.52.jar" />
		</fileset>      
	</path>
    
            
    <!-- clean -->
	<target name="clean" description="Clean .class files from the output directories">      
        <echo message="Cleaning build directories" />
        <delete dir="${build.dir}/com" failonerror="false"/>       
	</target>
          
    
    <!-- compile -->
    <target name="compile" description="Compile the Java source code">             
        <echo message="Compiling Java source"/>
     
        <!-- setting sourcepath="" means only files explicity included are compiled -->
		<javac sourcepath="" srcdir="${source.dir}" destdir="${build.dir}" 
			encoding="utf-8" source="1.6" deprecation="off" includeantruntime="false">
			<classpath>
				<path refid="build.classpath" />
			</classpath>
			<compilerarg value="-Xmaxerrs"/>
			<compilerarg value="250"/>            
            
            <include name="com/prelert/api/test/clw/*" />                        
            <include name="com/prelert/api/test/consumer/*" />                        
		</javac>
        
	</target>

    
    
    <!-- TO RUN TESTS:
        copy odata4j-0.7.0-bundle.jar and json-simple-1.1.1.jar into the same directory as prelertApiConsumer.jar 
        
        java -jar prelertApiConsumer.jar
        OR
        java -jar prelertApiConsumer.jar host:port/servicename
    -->
    
    <target name="build" depends="compile" description="Build the prelertApiConsumer.jar file">        
        <echo message="Building prelertApiConsumer.jar" />
        
        <mkdir dir="${project.basedir}/docs"/>
        
        
        <!-- current timestamp -->
        <tstamp>
            <format property="current.time" pattern="yyyy-MM-dd HH:mm:ss" />
        </tstamp>
  
        <!-- Create the java doc -->
        <javadoc packagenames="com.prelert.api.test.consumer, com.prelert.api.test.clw" sourcepath="${source.dir}" destdir="${project.basedir}/docs">
            <classpath>
				<path refid="build.classpath" />
			</classpath>
            <doctitle><![CDATA[<h1>Prelert ODATA API Integration Test</h1>]]></doctitle>
            <footer>Version: Unknown&lt;br/&gt;
                    Build: External Build ${current.time}
            </footer>
        </javadoc>  
              
        
        <echo message="Jaring the consumer test classes" />
        
		<!-- JAR up the test classes -->
		<jar destfile="${jar.output.dir}/prelertApiConsumer.jar" basedir="${project.basedir}" excludes="**/*.jar" >
            <manifest>
                <attribute name="Version" value="Uknown"/>
                <attribute name="Build" value="External Build ${current.time}"/>
                <!-- Set the main class and required jars -->
                <attribute name="Main-Class" value="com.prelert.api.test.consumer.ConsumerTest"/>
                <attribute name="Class-Path" value="odata4j-0.7.0-bundle.jar json-simple-1.1.1.jar"/>
            </manifest>  
        </jar>
	</target>

</project>
