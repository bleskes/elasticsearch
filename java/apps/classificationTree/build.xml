<?xml version="1.0" encoding="utf-8" ?>
<project name="ClassificationTree" default="build" basedir=".">
  <!-- Configure path to GWT SDK -->
  <property name="gwt.sdk" location="C:/Tools/gwt-windows-1.7.0" />
	
	
	<!-- Set global properties for this build -->
	<property file="build.properties" />
	<property name="name" value="classificationtree"/>
	<property name="src" location="${source.basedir}/src/main" />
	<property name="src.war" location="${project.basedir}/war" />
	<property name="build" location="${project.basedir}/build" />
	<property name="build.web.dir" value="${build}/war"/>
	
	<property name="gwt.entrypoint.class" value="demo.app.ClassificationTree" />
	<property name="gwt.module.shortname" value="classificationtree" />
	<property name="gwt.sdk.location" location="C:\Tools\gwt-windows-1.7.0" />
	<property name="ext.gwt.sdk.location" location="C:\Tools\gxt-2.0.1" />

	<property name="code.drop.dir" value="${project.basedir}/codedrop"/>
	
	<!-- GWT Compile Classpath -->
	<path id="gwt.compile.classpath">
		<pathelement location="${gwt.sdk.location}/gwt-user.jar" />
		<pathelement location="${gwt.sdk.location}/gwt-dev-windows.jar" />
		<pathelement location="${ext.gwt.sdk.location}/gxt.jar" />
		<pathelement location="${src}" />
	</path>
	
	<!-- Classpath for server-side classes -->
	<path id="build.classpath">
		<fileset dir="${appserver.lib}">
			<include name="servlet*.jar" />
		</fileset>

		<!-- GWT JARs -->
		<fileset dir="${gwt.sdk.location}">
			<include name="gwt-dev-windows.jar" />
			<include name="gwt-user.jar" />
		</fileset>

		<!-- Ext GWT JARs -->
		<fileset dir="${ext.gwt.sdk.location}">
			<include name="gxt.jar" />
		</fileset>
	</path>
	
	
	<target name="gwt-compile" description="Compiles the GWT classes to generate static content">
		<!-- Compilation of the GWT classes to static content -->
		<echo message="Compiling the GWT classes to generate static content" />

		<mkdir dir="${build}/compiled_gwt" />

		<java failonerror="true" classpathref="gwt.compile.classpath" classname="com.google.gwt.dev.Compiler" fork="true">
			<!-- add jvmarg -Xss16M or similar if you see a StackOverflowError -->
			<jvmarg value="-Xss16M"/>
			<jvmarg value="-Xmx256M"/>
			<arg value="-war" />
			<arg value="${build}/compiled_gwt" />
			<arg value="${gwt.entrypoint.class}" />
		</java>
	</target>


	<target name="build"  description="Generate the distribution">
		<echo message="Building the Classification Tree distribution" />

		<mkdir dir="${build.web.dir}" />

		<!-- Copy the GWT static content -->
		<copy todir="${build.web.dir}">
			<fileset dir="${src.war}">
				<include name="*.html" />
				<include name="ClassificationTree.css" />
			</fileset>
		</copy>
		
		<copy todir="${build.web.dir}/${name}/gwt">
			<fileset dir="${src.war}/${name}/gwt"/>
		</copy>
		<copy todir="${build.web.dir}/${name}/gxt">
			<fileset dir="${src.war}/${name}/gxt"/>
		</copy>
		<copy todir="${build.web.dir}/${name}/images">
			<fileset dir="${src.war}/${name}/images"/>
		</copy>

		<copy todir="${build.web.dir}/${name}">
			<fileset dir="${build}/compiled_gwt/${name}"/>
		</copy>
		
		
		<!-- Copy in the contents of WEB-INF directory -->
		<copy todir="${build.web.dir}/WEB-INF">
			<fileset dir="${src.war}/WEB-INF">
				<include name="web.xml" />
			</fileset>
		</copy>
		
		
		<!-- Build the WAR file -->
		<jar jarfile="${build}/${name}.war" basedir="${build.web.dir}"  />

	</target>
	
	
	<target name="deploy" depends="build" description="Deploy application">
		<echo message="Deploying the test desktop application" />
		
		<delete dir="${deploy.path}/${name}"/>
		<copy file="${build}/${name}.war" todir="${deploy.path}"/>
	</target>
	

	<target name="clean" description="Clean .class files and GWT files from output directories">
		
		<delete failonerror="false">
			<fileset dir="${build}/compiled_gwt/${gwt.module.shortname}">
				<include name="**/*.*" />
			</fileset>
		</delete>
		
		<delete dir="${build.web.dir}"/>
		
	</target>
	
	
	<target name="codedrop" description="Copies source code and associated files to single directory">
		<echo message="Copying source to single directory" />

		<mkdir dir="${code.drop.dir}" />
		<mkdir dir="${code.drop.dir}/src/main" />
		<mkdir dir="${code.drop.dir}/war" />
		<mkdir dir="${code.drop.dir}/web" />
		
		<!-- Copy the build files -->
		<copy todir="${code.drop.dir}">
			<fileset dir="${project.basedir}">
				<include name="build.xml" />
				<include name="build.properties" />
			</fileset>
		</copy>	
			
		<!-- Copy the Java source files -->
		<copy todir="${code.drop.dir}/src/main">
			<fileset dir="${src}">
				<include name="**/*.java" />
			</fileset>
		</copy>
		
		<!-- Copy the host html page and CSS stylesheet -->
		<copy file="${src}/demo/app/ClassificationTree.gwt.xml" todir="${code.drop.dir}/src/main/demo/app"/>
		<copy todir="${code.drop.dir}/war">
			<fileset dir="${src.war}">
				<include name="ClassificationTree.html"/>
				<include name="ClassificationTree.css"/>
			</fileset>
		</copy>

		
		<!-- Copy the web files -->
		<copy todir="${code.drop.dir}/web/WEB-INF">
			<fileset dir="${src.war}/WEB-INF">
				<include name="*.xml" />
			</fileset>
		</copy>
		
	</target>

</project>
