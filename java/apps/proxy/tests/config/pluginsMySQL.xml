<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
						http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
						http://www.springframework.org/schema/tx
						http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
						pluginhttp://www.springframework.org/schema/aop
						http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">

    <import resource="pluginLocator.xml"/>   


	<bean id="pluginDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
		<property name="driverClassName" value="com.mysql.jdbc.Driver"/>
		<property name="url" value="jdbc:mysql://localhost:3306/reference"/>
		<property name="username" value="root"/>
		<property name="password" value=""/>
		<property name="testOnBorrow" value="true"/>
		<property name="validationQuery" value="select 1"/>
	</bean>  

	<bean id="pluginDataSourceDAO" class="com.prelert.dao.mysql.DataSourceMySQLDAO">
		<property name="dataSource" ref="pluginDataSource" />
	</bean>

	<bean id="pluginEvidenceDAO" class="com.prelert.dao.mysql.EvidenceMySQLDAO">
		<property name="dataSource" ref="pluginDataSource" />
	</bean>

	<bean id="pluginIncidentDAO" class="com.prelert.dao.mysql.IncidentMySQLDAO">
		<property name="dataSource" ref="pluginDataSource" />
	</bean>

	<bean id="pluginTimeSeriesDAO" class="com.prelert.dao.mysql.TimeSeriesMySQLDAO">
		<property name="dataSource" ref="pluginDataSource" />
	</bean>

	<bean id="pluginLocatorDAO" class="com.prelert.proxy.PluginLocatorMySQLDAO">
		<property name="dataSource" ref="pluginDataSource" />
	</bean>

	<!-- prototype scope means a new instance of bean is returned for every request -->
	<bean id="testPlugin" class="com.prelert.proxy.plugin.localdatabase.PluginTestDatabase" scope="prototype" >
		<property name="dataSourceDAO" ref="pluginDataSourceDAO" />
		<property name="evidenceDAO" ref="pluginEvidenceDAO" />
		<property name="incidentDAO" ref="pluginIncidentDAO" />
		<property name="timeSeriesDAO" ref="pluginTimeSeriesDAO" />
		<property name="pluginLocatorDAO" ref="pluginLocatorDAO" />
	</bean>
    
        <!-- Introscope plugin -->
    <bean id="introscopePlugin" class="com.prelert.proxy.plugin.introscope.IntroscopePlugin" scope="prototype">
    </bean>
    
    <bean id="optimalQueryTime" class="com.prelert.proxy.plugin.introscope.OptimalUsage">        
        <property name="TestQueryDurations">
            <list>
                <value>2</value>
                <value>4</value>
                <value>6</value>
                <value>8</value>
                <value>10</value>
            </list>
        </property>
        <property name="MaxOverallCapacity" value="70" />                 
    </bean>

    <bean id="introscopeConfigServer" class="com.prelert.proxy.server.configuration.introscope.IntroscopeConfigServerRMI">
        <property name="pluginLocator" ref="pluginLocator" />
        <property name="serverName" value="com.prelert.IntroscopeConfigServer" />
        <property name="optimalUsage" ref="optimalQueryTime" />
    </bean>
    
    
    <bean id="configurationServer" class="com.prelert.proxy.server.configuration.ConfigurationServerRMI">
        <property name="pluginLocator" ref="pluginLocator" />
        <property name="introscopeConfigServer" ref="introscopeConfigServer" />
        <property name="serverName" value="com.prelert.ConfigurationServer" />
    </bean>  

</beans>
