<?xml version="1.0" encoding="UTF-8"?>
<project name="Prelert DevUtils" default="build" basedir=".">
	<description>
		Build file for Prelert Java Development Utilities.
	</description>

	<property environment="env" />

	<!-- Set base directory properties -->
	<property name="project.basedir" value="." />
	<property name="gui.basedir" value="../.." />
	<property name="resources" location="${gui.basedir}/resources" />

	<!-- Read Platfrom specfic property file --> 
	<condition property="property_file" value="${resources}/ant/build_linux.properties">
		<os name="Linux" />
	</condition>

	<condition property="property_file" value="${resources}/ant/build_osx.properties">
		<os family="mac" />
	</condition>

	<condition property="property_file" value="${resources}/ant/build_solaris_sparc.properties">
        <os name="SunOS" arch="sparc" />
    </condition>

    <condition property="property_file" value="${resources}/ant/build_solaris_x86.properties">
		<os name="SunOS" />
	</condition>

	<!-- Before checking for Windows, check if we're running within an msysgit shell -->
	<condition property="property_file" value="${resources}/ant/build_mingw.properties">
		<isset property="env.MSYSTEM" />
	</condition>

	<condition property="property_file" value="${resources}/ant/build_win.properties">
		<!-- Due to the test above, this means native Windows -->
		<os family="windows" />
	</condition>

	<fail message="Could not set plaftorm property file">
		<condition>
			<not>
				<isset property="property_file" />
			</not>
		</condition>
	</fail>
	
	<echo message="Using ${property_file}"/>

 	<property file="${property_file}" />

	<echo message="Using ${libs.basedir}"/>

	<!-- Set global properties for this build -->
	<property name="name" value="prelert"/>
	<property name="src.dir" location="${gui.basedir}/src" />
	<property name="build.dir" location="${project.basedir}/build" />
    <property name="lib.dir" location="${project.basedir}/lib" />

	
	<property name="JUnit.location" value="${libs.basedir}/junit-4.8.2/junit-4.8.2.jar"/>		
	<property name="apache.basedir" location="${libs.basedir}/apache" />
	<property name="apache.commons.basedir" location="${apache.basedir}/commons" />
	
    <!-- boot classpath -->
    <path id="boot.classpath">   
        <fileset dir="${java6.bootstrap.path}">
            <include name="rt.jar" />
            <include name="jce.jar" />
        </fileset>   
    </path>
	
	<!-- Apache log4j JAR Path -->
	<path id="log4j.path">
		<fileset dir="${apache.basedir}/apache-log4j-1.2.16">
			<include name="log4j-1.2.16.jar" />
		</fileset>	
	</path>
			
	<!-- Apache Commons JARS -->
	<path id="apache-commons">
		<fileset dir="${apache.commons.basedir}/commons-dbcp-1.4">
			<include name="commons-dbcp-1.4.jar" />
		</fileset>
		<fileset dir="${apache.commons.basedir}/commons-logging-1.1.1">
			<include name="commons-logging-1.1.1.jar" />
		</fileset>
		<fileset dir="${apache.commons.basedir}/commons-pool-1.5.5">
			<include name="commons-pool-1.5.5.jar" />
		</fileset>	
        <fileset dir="${apache.commons.basedir}/commons-cli-1.2">
			<include name="commons-cli-1.2.jar" />
		</fileset>	
        <fileset dir="${apache.commons.basedir}/commons-codec-1.6">
            <include name="commons-codec-1.6.jar" />
        </fileset>
        <fileset dir="${apache.commons.basedir}/commons-lang-2.6">
            <include name="commons-lang-2.6.jar" />
        </fileset>
	</path>
    
    <!-- Apache Axis JAR Path -->
	<path id="axis.path">
		<fileset dir="${apache.basedir}/axis-1.4/lib">
			<include name="axis.jar" />
			<include name="jaxrpc.jar" />
			<!-- May need to add SAAJ too -->
		</fileset>
	</path>
    
    <!-- SuperCSV -->
    <path id="supercsv.path">
		<fileset dir="${libs.basedir}/SuperCSV-1.52/">
			<include name="SuperCSV-1.52.jar" />
		</fileset>	
	</path>
    
    
    <!-- Introscope Web Services SDK -->
	<path id="introscopeWsSdk.path">
		<fileset dir="${libs.basedir}/Introscope/WebServices">
			<include name="introscope-wssdk-consumer-intf.jar" />
		</fileset>
	</path>
    
    <!-- Introscope Command Line Workstation -->
	<path id="introscopeClw.path">
		<fileset dir="${libs.basedir}/Introscope/CLW">
			<include name="CLWorkstation.jar" />
		</fileset>
	</path>
	
    <!-- Introscope JDBC driver -->
	<path id="introscopeJDBC.path">
		<fileset dir="${libs.basedir}/Introscope/JdbcDriver">
			<include name="IntroscopeJDBC.jar" />
		</fileset>
	</path>
    
    
    <path id="sqlserver.path">
		<fileset dir="${libs.basedir}/sql-server/sqljdbc_3.0/">
			<include name="sqljdbc4.jar" /> 
		</fileset>
	</path>



	<path id="build.classpath">
		<path refid="log4j.path" />
		<path refid="apache-commons" />
        <path refid="supercsv.path" />
        <path refid="introscopeWsSdk.path" />
        <path refid="introscopeJDBC.path" />
        <path refid="introscopeClw.path" />
        <path refid="axis.path" />
        <path refid="sqlserver.path" />
	</path>


	<target name="build" description="compile the source">
		<!-- Compiles the Java source code -->
		<echo message="Compiling the Dev Utils classes" />

		<mkdir dir="${build.dir}"/>

		<javac srcdir="${src.dir}" destdir="${build.dir}" 
			encoding="utf-8" source="1.6" target="1.6" deprecation="off" includeantruntime="false">
            <bootclasspath>
                <path refid="boot.classpath" />
            </bootclasspath>
			<classpath>
				<path refid="build.classpath" />
			</classpath>
			<compilerarg value="-Xmaxerrs"/>
			<compilerarg value="250"/>

			<include name="com/prelert/devutils/**"/> 
			
            <exclude name="com/prelert/data/gxt/**" />
			<exclude name="com/prelert/dao/**" />
			
            <exclude name="com/prelert/client/**"/>
			<exclude name="com/prelert/proxy/**"/>
		</javac>
	</target>

	
	<target name="deploy" depends="build" description="Create a prelert-utils.jar file containing all the classes">
		<echo message="Building prelert-utils.jar into ${lib.dir}" />
		
		<mkdir dir="${lib.dir}"/>

        <condition property="build.number" value="${env.PRELERT_BUILD_NUM}" else="DEVELOPMENT BUILD by ${user.name}">
            <isset property="env.PRELERT_BUILD_NUM" />        
        </condition>
        
        <!-- Read in version properties -->
        <property file="${gui.basedir}/../version.properties"/>

		<!-- Here we exclude the individual plugin classes, as these must go in
			 separate .jar files -->
		<jar destfile="${lib.dir}/prelert-utils.jar" 			
			basedir="${build.dir}"> 
            <manifest>
                <attribute name="Version" value="${version.major}.${version.minor}.${version.revision}"/>
                <attribute name="Build" value="${build.number}"/>
            </manifest>  
        </jar>
	</target>
	


	<target name="clean" description="Clean .class files from output directories">
		<echo message="Cleaning Prelert classes and Jar file" />

		<mkdir dir="${build.dir}" />
        <mkdir dir="${lib.dir}" />

		<!-- delete all the classes. -->
		<delete>
			<fileset dir="${build.dir}">
				<include name="**/*.class"/>
			</fileset>
            <fileset dir="${lib.dir}">
				<include name="*.jar"/>
			</fileset>
		</delete>
		
	</target>
	
</project>
