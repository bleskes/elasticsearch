<?xml version="1.0" encoding="utf-8" ?>
<project name="GwtClient" default="build" basedir=".">
    <description>
        Build file for the Prelert Gxt Components.
    </description>
    
    <!-- Set base directory properties -->
    <property environment="env" />
    <property name="project.basedir" value="." />
    <property name="java.basedir" value="../.." />
    <property name="resources" location="${java.basedir}/resources" />

    <!-- Read Platfrom specfic property file --> 
    <condition property="property_file" value="${resources}/ant/build_linux.properties">
        <os name="Linux" />
    </condition>

    <condition property="property_file" value="${resources}/ant/build_osx.properties">
        <os family="mac" />
    </condition>
    
    <condition property="property_file" value="${resources}/ant/build_solaris_sparc.properties">
        <os name="SunOS" arch="sparc" />
    </condition>

    <condition property="property_file" value="${resources}/ant/build_solaris_x86.properties">
        <os name="SunOS" />
    </condition>
    
    <!-- Before checking for Windows, check if we're running within an msysgit shell -->
    <condition property="property_file" value="${resources}/ant/build_mingw.properties">
        <isset property="env.MSYSTEM" />
    </condition>

    <condition property="property_file" value="${resources}/ant/build_win.properties">
        <!-- Due to the test above, this means native Windows -->
        <os family="windows" />
    </condition>

    <fail message="Could not set plaftorm property file">
        <condition>
            <not>
                <isset property="property_file" />
            </not>
        </condition>
    </fail>
    
    <echo message="Using ${property_file}"/>

    <property file="${property_file}" />
    
    <property name="name" value="prelert"/>
    <property name="src" location="${java.basedir}/src" />
    <property name="src.config" location="${resources}/config" />
    <property name="resources" location="${java.basedir}/resources" />
    <property name="build" location="${project.basedir}/build" />
    <property name="war.dir" value="${project.basedir}/war"/>
    <property name="git.basedir" location="${java.basedir}/.." />
    <property name="prelert.home" location="${env.PRELERT_HOME}" />
    
    <!-- Arguments to gwt-compile and devmode targets -->
    <property name="gwt.args" value="" />

    <!-- Configure path to GWT SDK -->
    <property name="gwt.sdk.location" location="${libs.basedir}/gwt-2.4.0" />
    <property name="gxt.sdk.location" location="${libs.basedir}/gxt-3.0.1" />  

    <path id="gwt.compile.classpath">
	    <pathelement location="${gwt.sdk.location}/gwt-user.jar"/>
	    <pathelement location="${gwt.sdk.location}/gwt-dev.jar"/>
	    <pathelement location="${gxt.sdk.location}/gxt-3.0.1.jar"/>
	    <pathelement location="${gwt.sdk.location}/validation-api-1.0.0.GA.jar" />
	    <pathelement location="${gwt.sdk.location}/validation-api-1.0.0.GA-sources.jar" />
    </path>

    <target name="gwt-compile" description="Compiles the GWT classes to generate static content">
        <echo message="Compiling the GWT classes to generate static content" />
    
	    <java failonerror="true" classname="com.google.gwt.dev.Compiler" fork="true">
	        <classpath>
		        <path refid="gwt.compile.classpath"/>            
		        <pathelement location="${src}"/>
	        </classpath>
			<jvmarg value="-Xss16M"/>
			<jvmarg value="-Xmx512M"/>
	        <arg line="-war"/>
	        <arg value="${war.dir}"/>
	        <arg line="${gwt.args}"/>
	        <arg value="com.prelert.gxt3.GwtClient"/>
	    </java>
    </target>
    

    <target name="devmode" description="Run development mode">
	    <java failonerror="true" fork="true" classname="com.google.gwt.dev.DevMode">
	        <classpath>
		        <path refid="gwt.compile.classpath"/>            
		        <pathelement location="${build}"/>
		        <pathelement location="${src}"/>                    
	        </classpath>
			<jvmarg value="-Xss16M"/>
			<jvmarg value="-Xmx512M"/>
	        <arg value="-startupUrl"/>
	        <arg value="GwtClient.html"/>
	        <arg line="-war"/>
	        <arg value="${war.dir}" />
	        <arg line="${gwt.args}"/>
	        <arg value="com.prelert.gxt3.GwtClient"/>
	    </java>
    </target>
  
    <target name="build" depends="gwt-compile" description="Build this project" />

    <target name="clean" description="Clean .class files and GWT files from output directories">
        <delete dir="${project.basedir}gwt-unitCache" failonerror="false"/>
        <delete dir="${war.dir}/gwtclient" failonerror="false"/>
        <delete dir="${war.dir}/WEB-INF" failonerror="false"/>        
    </target>

</project>
